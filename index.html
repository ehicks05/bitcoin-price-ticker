<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css" />
</head>
<body>

<section class="section">
    <div class="container">
        <div style="font-size: 4em;" class="title is-1" id="price"></div>
        <div class="subtitle is-3" id="time"></div>
    </div>
</section>

<footer class="footer">
    <div class="content">
        <div class="container">
            <p>
                <span id="timeSince"></span>
            </p>
        </div>
    </div>
</footer>

<script>
    var subscribeMessage = {
        "type": "subscribe",
        "product_ids": [
            "BTC-USD"
        ],
        "channels": [
            "ticker"
        ]
    };

    var cbSocket = new WebSocket("wss://ws-feed.pro.coinbase.com");

    cbSocket.onopen = function (event) {
        cbSocket.send(JSON.stringify(subscribeMessage));
    };

    cbSocket.onmessage = function (event) {
        console.log(event.data);
        var response = JSON.parse(event.data);

        lastUpdate = new Date();
        var timeSinceLastUpdate = getTimeSinceLastUpdate(currentTime, lastUpdate);

        var price = response.price;
        price = "$" + Number.parseFloat(price).toFixed(2);

        document.getElementById("timeSince").innerText = timeSinceLastUpdate;
        document.getElementById("price").innerText = price;
    };

    var currentTime = new Date();
    var lastUpdate = new Date();
    setInterval(function (args)
        {
            currentTime = new Date();
            var timeSinceLastUpdate = getTimeSinceLastUpdate(currentTime, lastUpdate);

            document.getElementById("time").innerText = currentTime.toLocaleTimeString();
            document.getElementById("timeSince").innerText = timeSinceLastUpdate;

        }, 100);

    function getTimeSinceLastUpdate(currentTime, lastUpdate)
    {
        return "Seconds since last update: " + Math.round(Math.max(currentTime - lastUpdate, 0) / 1000);
    }

</script>

</body>
</html>